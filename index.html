<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>浩瀚星際：太陽系漫遊</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Segoe UI', sans-serif; }
        #canvas-container { width: 100vw; height: 100vh; position: absolute; top: 0; left: 0; z-index: 1; }
        .ui-layer { position: absolute; z-index: 10; pointer-events: none; width: 100%; height: 100%; }
        .interactive { pointer-events: auto; }

        /* 玻璃面板 */
        .glass-panel {
            background: rgba(20, 25, 40, 0.8); /* 稍微調亮一點點底色 */
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
            transition: all 0.6s cubic-bezier(0.22, 1, 0.36, 1);
        }

        /* 按鈕樣式 */
        .planet-btn {
            width: 60px; height: 60px; border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.2);
            background-size: cover; background-position: center;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            cursor: pointer; flex-shrink: 0; position: relative;
            background-color: #000;
        }
        .planet-btn.active {
            transform: scale(1.3) translateY(-10px);
            border-color: #fff;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
            z-index: 20;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Loading */
        #loader {
            position: fixed; inset: 0; background: #000000; z-index: 999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 1s ease-out;
        }
    </style>
</head>
<body>

    <div id="loader">
        <div class="relative w-20 h-20 mb-6">
            <div class="absolute inset-0 border-t-2 border-white rounded-full animate-spin"></div>
        </div>
        <div class="text-white text-xs tracking-[0.5em] font-light">LOADING STARS</div>
    </div>

    <div id="canvas-container"></div>

    <div class="ui-layer flex flex-col justify-between p-6">
        
        <div class="mt-4 ml-2">
            <h1 class="text-white font-bold text-4xl tracking-widest drop-shadow-2xl" style="font-family: 'Impact', sans-serif;">SOLAR SYSTEM</h1>
            <p class="text-white/60 text-[10px] mt-1 tracking-[0.4em] uppercase">Virtual Space Tour</p>
        </div>

        <div id="infoModal" class="glass-panel absolute top-1/2 left-4 md:left-12 -translate-y-1/2 w-[90%] max-w-[360px] p-8 opacity-0 translate-x-[-40px] pointer-events-none">
            <div class="absolute -top-4 -right-2 text-[100px] font-bold text-white/5 pointer-events-none select-none" id="mBgNum" style="font-family: Impact;">01</div>
            
            <h2 id="mName" class="text-4xl font-bold text-white mb-1 drop-shadow-md">PLANET</h2>
            <p id="mEn" class="text-blue-300 text-xs font-bold tracking-[0.25em] mb-6 uppercase">System</p>
            
            <div class="h-[1px] w-full bg-white/20 mb-6"></div>
            
            <p id="mDesc" class="text-gray-200 text-sm leading-7 mb-8 font-light text-justify tracking-wide">
                Description...
            </p>

            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white/10 rounded-xl p-3 border border-white/10 backdrop-blur-sm">
                    <div class="text-[10px] text-white/60 mb-1 uppercase tracking-wider">Type</div>
                    <div id="mTag1" class="text-sm text-white font-medium">Data</div>
                </div>
                <div class="bg-white/10 rounded-xl p-3 border border-white/10 backdrop-blur-sm">
                    <div class="text-[10px] text-white/60 mb-1 uppercase tracking-wider">Distance</div>
                    <div id="mTag2" class="text-sm text-white font-medium">Data</div>
                </div>
            </div>
        </div>

        <div class="w-full interactive pb-8">
            <div class="flex justify-center items-center gap-6 overflow-x-auto px-10 py-4 no-scrollbar" id="menuContainer"></div>
        </div>
    </div>

    <script type="importmap">
        { "imports": { "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js", "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/" } }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // ==========================================
        // 1. 資料設定 (透視排列)
        // ==========================================
        const planetsData = [
            { 
                id: 'mercury', name: '水星', en: 'MERCURY', 
                desc: '太陽系中最小且最接近太陽的行星。表面佈滿隕石坑，看起來很像月球。這裡沒有大氣層調節，白天溫度高達 430°C，晚上則驟降至 -180°C。', 
                tag1: '岩石行星', tag2: '0.39 AU', 
                tex: 'https://upload.wikimedia.org/wikipedia/commons/3/30/Mercury_in_color_-_Prockter07_centered.jpg', 
                size: 0.8, pos: 0, zOffset: 8 
            },
            { 
                id: 'venus', name: '金星', en: 'VENUS', 
                desc: '夜空中最亮的天體，擁有極厚重的二氧化碳大氣層，是太陽系最熱的行星（465°C）。它的自轉方向與其他行星相反，在那裡太陽是從西邊升起的。', 
                tag1: '岩石行星', tag2: '0.72 AU', 
                tex: 'https://upload.wikimedia.org/wikipedia/commons/0/02/Venus_globe_-_magellan_radar_1024.jpg', 
                size: 1.2, pos: 25, zOffset: -12
            },
            { 
                id: 'earth', name: '地球', en: 'EARTH', 
                desc: '我們的家園，唯一已知存在生命的藍色星球。71% 的表面被海洋覆蓋。大氣層富含氧氣，並擁有保護性的磁場，阻擋有害的太陽輻射。', 
                tag1: '生命搖籃', tag2: '1.00 AU', 
                tex: 'https://upload.wikimedia.org/wikipedia/commons/c/c3/Solarsystemscope_texture_2k_earth_daymap.jpg', 
                size: 1.3, pos: 50, zOffset: 10
            },
            { 
                id: 'mars', name: '火星', en: 'MARS', 
                desc: '富含氧化鐵的「紅色星球」。擁有太陽系最高的奧林帕斯火山。這裡有乾涸的河床與極地冰帽，是人類星際移民的首要目標。', 
                tag1: '岩石行星', tag2: '1.52 AU', 
                tex: 'https://upload.wikimedia.org/wikipedia/commons/0/02/OSIRIS_Mars_true_color.jpg', 
                size: 1.0, pos: 75, zOffset: -18
            },
            { 
                id: 'jupiter', name: '木星', en: 'JUPITER', 
                desc: '巨大的氣態行星，體積可容納 1300 個地球。主要由氫和氦組成。表面標誌性的「大紅斑」是一個比地球還大的超級風暴，已持續數百年。', 
                tag1: '氣態巨星', tag2: '5.20 AU', 
                tex: 'https://upload.wikimedia.org/wikipedia/commons/e/e2/Jupiter.jpg', 
                size: 3.5, pos: 115, zOffset: 12
            },
            { 
                id: 'saturn', name: '土星', en: 'SATURN', 
                desc: '以其夢幻般的冰環系統聞名。土星環由數十億個冰塊和岩石組成。它是密度最低的行星，理論上如果放在超大浴缸裡，它會浮在水面上。', 
                tag1: '氣態巨星', tag2: '9.58 AU', 
                tex: 'https://upload.wikimedia.org/wikipedia/commons/b/b4/Saturn_%28planet%29_large.jpg', 
                size: 3.0, pos: 155, zOffset: -22, ring: true
            }
        ];

        // ==========================================
        // 2. 場景與相機
        // ==========================================
        const scene = new THREE.Scene();
        // 移除霧氣，保持星空清晰
        // scene.fog = new THREE.FogExp2(0x000000, 0.002); 

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 2000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.enablePan = false;
        controls.minDistance = 5; 
        controls.maxDistance = 200;

        // ==========================================
        // 3. 建立簡單星空 (解決背景問題)
        // ==========================================
        function createSimpleStarField() {
            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            
            // 隨機產生 5000 個點
            for (let i = 0; i < 5000; i++) {
                vertices.push(
                    THREE.MathUtils.randFloatSpread(1000), // X (-500 ~ 500)
                    THREE.MathUtils.randFloatSpread(1000), // Y
                    THREE.MathUtils.randFloatSpread(1000)  // Z
                );
            }
            
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            
            // 使用 PointsMaterial 建立簡單的白色點
            const material = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.7, // 星星大小
                transparent: true,
                opacity: 0.8,
                sizeAttenuation: true // 距離越遠看起來越小
            });
            
            const stars = new THREE.Points(geometry, material);
            scene.add(stars);
        }
        createSimpleStarField();

        // 燈光
        const sunLight = new THREE.DirectionalLight(0xffffff, 2.0);
        sunLight.position.set(-50, 30, 50);
        scene.add(sunLight);
        
        const fillLight = new THREE.DirectionalLight(0xccccff, 0.4);
        fillLight.position.set(50, 0, -50);
        scene.add(fillLight);

        const ambientLight = new THREE.AmbientLight(0x222222, 1);
        scene.add(ambientLight);

        // ==========================================
        // 4. 建立星球
        // ==========================================
        const loader = new THREE.TextureLoader();
        const planetMeshes = [];
        
        planetsData.forEach(data => {
            const geometry = new THREE.SphereGeometry(data.size, 64, 64);
            const material = new THREE.MeshStandardMaterial({
                map: loader.load(data.tex),
                roughness: 0.8, metalness: 0.1
            });
            const mesh = new THREE.Mesh(geometry, material);
            mesh.position.set(data.pos, 0, data.zOffset);
            
            // 土星環
            if(data.ring) {
                const ringGeo = new THREE.RingGeometry(data.size * 1.4, data.size * 2.6, 64);
                const ringMat = new THREE.MeshStandardMaterial({
                    color: 0xc4b098, side: THREE.DoubleSide, transparent: true, opacity: 0.9,
                    map: loader.load('https://i.imgur.com/4xT8zQZ.png')
                });
                const pos = ringGeo.attributes.position;
                const v3 = new THREE.Vector3();
                for (let i = 0; i < pos.count; i++) {
                    v3.fromBufferAttribute(pos, i);
                    ringGeo.attributes.uv.setXY(i, v3.length() < data.size * 2.0 ? 0 : 1, 1);
                }
                const ring = new THREE.Mesh(ringGeo, ringMat);
                ring.rotation.x = Math.PI / 2;
                mesh.add(ring);
                mesh.rotation.z = Math.PI / 8;
                mesh.rotation.x = Math.PI / 8;
            }

            scene.add(mesh);
            planetMeshes.push(mesh);
        });

        // ==========================================
        // 5. 運鏡與聚焦 (解決聚焦大小問題)
        // ==========================================
        function flyToPlanet(index) {
            const targetPlanet = planetMeshes[index];
            const data = planetsData[index];

            toggleModal(false);

            // *** 關鍵修改：拉遠攝影機距離 ***
            // 距離改為星球大小的 5.0 倍 (之前是 2.5 倍，太近了)
            const dist = data.size * 5.0; 
            
            // 稍微偏一點點角度，比較有立體感，但幾乎是正對
            const offsetX = data.size * 0.2;
            
            const targetPos = { 
                x: targetPlanet.position.x + offsetX, 
                y: data.size * 0.3, 
                z: targetPlanet.position.z + dist 
            };
            
            new TWEEN.Tween(camera.position)
                .to(targetPos, 2000)
                .easing(TWEEN.Easing.Cubic.InOut)
                .onUpdate(() => {
                    controls.target.set(targetPlanet.position.x, 0, targetPlanet.position.z);
                })
                .onComplete(() => {
                    updateModalContent(index);
                    toggleModal(true);
                    // 設定最小縮放距離，防止使用者拉太近
                    controls.minDistance = data.size * 2.5;
                })
                .start();

            new TWEEN.Tween(controls.target)
                .to({ x: targetPlanet.position.x, y: 0, z: targetPlanet.position.z }, 2000)
                .easing(TWEEN.Easing.Cubic.InOut)
                .start();
        }

        // ==========================================
        // UI & Loop
        // ==========================================
        const modal = document.getElementById('infoModal');
        const menuContainer = document.getElementById('menuContainer');

        function updateModalContent(index) {
            const data = planetsData[index];
            document.getElementById('mBgNum').innerText = `0${index + 1}`;
            document.getElementById('mName').innerText = data.name;
            document.getElementById('mEn').innerText = data.en;
            document.getElementById('mDesc').innerText = data.desc;
            document.getElementById('mTag1').innerText = data.tag1;
            document.getElementById('mTag2').innerText = data.tag2;
        }

        function toggleModal(show) {
            if(show) {
                modal.classList.remove('opacity-0', 'translate-x-[-40px]');
                modal.classList.add('opacity-100', 'translate-x-0');
            } else {
                modal.classList.add('opacity-0', 'translate-x-[-40px]');
                modal.classList.remove('opacity-100', 'translate-x-0');
            }
        }

        planetsData.forEach((p, i) => {
            const btn = document.createElement('div');
            btn.className = 'planet-btn';
            btn.style.backgroundImage = `url(${p.tex})`;
            btn.onclick = () => {
                document.querySelectorAll('.planet-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                flyToPlanet(i);
            };
            menuContainer.appendChild(btn);
        });

        // Start
        const startIndex = 2; // Earth
        camera.position.set(0, 20, 100);
        
        setTimeout(() => {
            document.getElementById('loader').style.opacity = 0;
            setTimeout(() => document.getElementById('loader').style.display = 'none', 1000);
            menuContainer.children[startIndex].click();
        }, 1500);

        function animate(time) {
            requestAnimationFrame(animate);
            TWEEN.update(time);
            controls.update();
            planetMeshes.forEach(m => m.rotation.y += 0.002);
            // 背景不轉動，保持靜謐感
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
